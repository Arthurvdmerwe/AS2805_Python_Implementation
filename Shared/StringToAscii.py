# Converts Ascii string to more readable format
import sys
controls_dic = {
 0: '<NUL>',  1: '<SOH>',  2: '<STX>',  3: '<ETX>',  4: '<EOT>',  5: '<ENQ>',  6: '<ACK>',
 7: '<BEL>',  8: '<BS>' ,  9: '<HT>' , 10: '<LF>' , 11: '<VT>' , 12: '<FF>' , 13: '<CR>' ,
14: '<SO>' , 15: '<SI>' , 16: '<DLE>', 17: '<DC1>', 18: '<DC2>', 19: '<DC3>',
20: '<DC4>', 21: '<NAK>', 22: '<SYN>', 23: '<ETB>', 24: '<CAN>', 25: '<EM>',
26: '<SUB>', 27: '<ESC>', 28: '<FS>' , 29: '<GS>' , 30: '<RS>' , 31: '<US>'
}

def Str2Ascii(s):
    r = ''
    for c in s:
        if ord(c) < 32:
            r = r + controls_dic[ord(c)]
        elif ord(c) >= 127:
            r += '<%d>' % ord(c)
        else:
            r = r + c
    return r




reverse_dic5 = { 
'<NUL>':  0, '<SOH>':  1, '<STX>':  2, '<ETX>':  3, '<EOT>':  4, '<ENQ>':  5, '<ACK>':  6,
'<BEL>':  7, '<DLE>': 16, '<DC1>': 17, '<DC2>': 18, '<DC3>': 19,
'<DC4>': 20, '<NAK>': 21, '<SYN>': 22, '<ETB>': 23, '<CAN>': 24, 
'<SUB>': 26, '<ESC>': 27
}

reverse_dic4 = {
'<BS>' :  8, '<HT>' :  9, '<LF>' : 10, '<VT>' : 11, '<FF>' : 12, '<CR>' : 13,
'<SO>' : 14, '<SI>' : 15, '<EM>' : 25, '<FS>' : 28, '<GS>' : 29, '<RS>' : 30, '<US>' : 31
}

reverse_dicN = {
               '<130>':130, '<140>':140, '<150>':150, '<160>':160, '<170>':170, '<180>':180, '<190>':190, '<200>':200, '<210>':210, '<220>':220, '<230>':230, '<240>':240, '<250>':250,               
               '<131>':131, '<141>':141, '<151>':151, '<161>':161, '<171>':171, '<181>':181, '<191>':191, '<201>':201, '<211>':211, '<221>':221, '<231>':231, '<241>':241, '<251>':251,               
               '<132>':132, '<142>':142, '<152>':152, '<162>':162, '<172>':172, '<182>':182, '<192>':192, '<202>':202, '<212>':212, '<222>':222, '<232>':232, '<242>':242, '<252>':252,               
               '<133>':133, '<143>':143, '<153>':153, '<163>':163, '<173>':173, '<183>':183, '<193>':193, '<203>':203, '<213>':213, '<223>':223, '<233>':233, '<243>':243, '<253>':253,               
               '<134>':134, '<144>':144, '<154>':154, '<164>':164, '<174>':174, '<184>':184, '<194>':194, '<204>':204, '<214>':214, '<224>':224, '<234>':234, '<244>':244, '<254>':254,               
               '<135>':135, '<145>':145, '<155>':155, '<165>':165, '<175>':175, '<185>':185, '<195>':195, '<205>':205, '<215>':215, '<225>':225, '<235>':235, '<245>':245, '<255>':255,               
               '<136>':136, '<146>':146, '<156>':156, '<166>':166, '<176>':176, '<186>':186, '<196>':196, '<206>':206, '<216>':216, '<226>':226, '<236>':236, '<246>':246,                
'<127>' : 127, '<137>':137, '<147>':147, '<157>':157, '<167>':167, '<177>':177, '<187>':187, '<197>':197, '<207>':207, '<217>':217, '<227>':227, '<237>':237, '<247>':247,                
'<128>' : 128, '<138>':138, '<148>':148, '<158>':158, '<168>':168, '<178>':178, '<188>':188, '<198>':198, '<208>':208, '<218>':218, '<228>':228, '<238>':238, '<248>':248,                
'<129>' : 129, '<139>':139, '<149>':149, '<159>':159, '<169>':169, '<179>':179, '<189>':189, '<199>':199, '<209>':209, '<219>':219, '<229>':229, '<239>':239, '<249>':249                
}

def Ascii2Str(s):
    r = ''
    i = 0
    l = len(s)
    while i < l:
        if s[i] == '<':
            try:
                x = reverse_dic5[s[i:i+5]]
                r += chr(x)
                i += 5
            except KeyError:
                try:
                    x = reverse_dic4[s[i:i+4]]
                    r += chr(x)
                    i += 4
                except KeyError:
                    try:
                        x = reverse_dicN[s[i:i+5]]
                        r += chr(x)
                        i += 5
                    except KeyError:
                        r = r + s[i]
                        i += 1
        else:
            r = r + s[i]
            i += 1
    return r


if __name__ == '__main__':
    #s = "<STX>"
    #print "Input  = [%s]" % s
    #print "Output = [%s]" % Str2Ascii(Ascii2Str(s))

    #print "Str = [%s]" % Ascii2Str(s)
    message = '02  41  3D  31  2D  31  2D  31  2D  31  2D  31  2D  31  2D  31  2D  31  03  52'.replace(" ", "").decode("hex")
    print >>sys.stderr, 'sending "%s"' % message
    print >>sys.stderr, 'sending -- pretty "%s"' % Str2Ascii(message)